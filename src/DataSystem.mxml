<?xml version="1.0"?>
<!-- Simple example to demonstrate the Spark TabBar -->
<s:WindowedApplication xmlns:fx="http://ns.adobe.com/mxml/2009"
					   xmlns:s="library://ns.adobe.com/flex/spark"
					   xmlns:mx="library://ns.adobe.com/flex/mx"
					   xmlns:MyComponent="com.jeff.MyComponent.*" fontSize="20"  title="个体驾驶员信息系统v0.9" initialize="getData()" creationComplete="assignData()" resize="onResize()" xmlns:myComponents="myComponents.*">
	
	<fx:Style>
		@namespace "library://ns.adobe.com/flex/spark";
		
		NavigatorContent ToggleButton:upAndSelected,
		NavigatorContent ToggleButton:overAndSelected,
		NavigatorContent ToggleButton:downAndSelected,
		NavigatorContent ToggleButton:disabledAndSelected {
			chromeColor: #9999CC;
			color: #F00E34;
			fontSize: 18;
		} 	
		
		/*  NavigatorContent {
			chromeColor: #9999CC;
			color: #410FF5;
			cornerRadius:8;
			fontSize: 20;
		}  */
	</fx:Style>
	<!--DataManager 掌管所有data数据-->
	<fx:Script>
		<![CDATA[			
			import Values.GlobalValue;
			
			import com.jeff.dataControler.DataManager;
			import com.jeff.myEvent.XMLEvent;
			
			import mx.core.IFlexDisplayObject;
			import mx.managers.PopUpManager;
			
			import myComponents.TitleWindows;
			private var addTileWin:TitleWindows;
			
			public function getData():void
			{
				var request:URLRequest = new URLRequest("/data/tableList.xml");  
				var loader:URLLoader = new URLLoader(request);  
				loader.addEventListener(Event.COMPLETE, loaderCompleteHandler); 
			
				maximize();
				_resizeAllComponent()
				showStatusBar=false;
				DataManager.getInstance().saveData();
			}
			
			private function loaderCompleteHandler(event:Event):void
			{
				GlobalValue._xmlData=XML(event.target.data);					
			}
			
			public function assignData():void
			{		
				
			}
			
			private function onResize():void
			{						
				_resizeAllComponent()
			}
			
			//弹出添加窗口
			private function addTitleWin($mode:uint=0):void
			{		
				//$mode=0:add 1:edit 2:check
				//应该设为全局				
				addTileWin=TitleWindows(PopUpManager.createPopUp(this, TitleWindows,true));
				
				addTileWin._editMode=$mode;
			
				addTileWin.addEventListener("close", closeHandler);	
				addTileWin.addEventListener(XMLEvent.DATA_COMBINED,_refreshMainTable)
				addTileWin.x=20;
				addTileWin.y=20;
				_resizeAllComponent()
			}
			
			private function _resizeAllComponent():void
			{
				if(addTileWin)
				{
					addTileWin.width=this.width-40;
					addTileWin.height=this.height-40;
				}
			}
			//关闭弹出窗口
			private function closeHandler(event:Event):void {
				event.target.removeEventListener("close", closeHandler);
				addTileWin.removeEventListener(XMLEvent.DATA_COMBINED,_refreshMainTable)
				PopUpManager.removePopUp(event.target as IFlexDisplayObject);
				System.gc();
			}
			
			private function deleteRow():void
			{				
				var _selectedId:uint=mainTable.selectedIndex
					
				if(_selectedId<0)
				{
					return;
				}
				trace("delete:",mainTable.selectedIndex);
				delete DataManager.getInstance()._wholeData.emp[_selectedId];
				_refreshMainTable()
				trace( DataManager.getInstance()._wholeData)
			}
			
			//create whole data
			private function _refreshMainTable(e:XMLEvent=null):void
			{				
				mainTable.dataProvider= DataManager.getInstance()._wholeData.emp.mainTab;					
			}
		]]>
	</fx:Script>
	<s:layout>
		<s:VerticalLayout paddingLeft="10" paddingRight="10" paddingTop="10" paddingBottom="10"/>
	</s:layout>
	
	<mx:HDividedBox width="100%" height="100%">				
			<s:VGroup width="35%" height="100%">
				<s:VGroup >										
					<s:DropDownList id="direction" prompt="请选择查找类型">
						<s:dataProvider>
							<mx:ArrayList>
								<fx:String>姓名</fx:String>
								<fx:String>身份证号</fx:String>
								<fx:String>手机号</fx:String>
								<fx:String>固定电话</fx:String>
								<fx:String>驾驶证</fx:String>
							</mx:ArrayList>
						</s:dataProvider>
					</s:DropDownList>						
					<s:HGroup>
						<s:TextInput id="searchText"/>
						<s:Button label="查询"/>
					</s:HGroup>					
				</s:VGroup>				
				<s:List height="100%" width="100%"/>			
			</s:VGroup>		
			<!--右边主控制区域-->
			<s:VGroup width="65%" height="100%">
				<s:HGroup>
					<s:Button label="添加" click="addTitleWin()"/>
					<s:Button label="删除" click="deleteRow()"/>
					<s:Button label="修改" click="addTitleWin(1)"/>
				</s:HGroup>
				<myComponents:MainSheet id="mainTable" width="100%" height="100%"/>
			</s:VGroup>				
	</mx:HDividedBox>		
</s:WindowedApplication>